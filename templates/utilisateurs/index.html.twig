{% extends 'base.html.twig' %}
{% block title 'Utilisateurs' %}
{% block body %}
    <form method="POST" action="{{ path('utilisateurs.add') }}">
        <select id="util_select" name="typeUtil">
            <option value="Eleves">Eleves</option>
            <option value="Professeurs">Professeurs</option>
            <option value="Personnels">Personnels</option>
        </select>
        {#        <button id="offsetMoins"><</button>#}
        {#        <button id="offsetPlus">></button>#}
        <div id="ajax_results">

        </div>
        <input type="submit" value="Ajouter">
    </form>
{% endblock %}
{% block javascripts %}
    <script>
        let select = $('#util_select');
        let div = $('#ajax_results');
        let plus = $('#offsetPlus');
        let moins = $('#offsetMoins');

        let offset = 0;

        $(moins).click(function () {
            offset -= 1;
        })

        $(plus).click(function () {
            offset += 1;
        })

        function refreshDiv(arr) {
            let user = select.val();
            let str = "";
            str += '<ul>';
            arr.forEach(function(obj){
                str += '<li>';
                str += '<div class = "nom">';
                str +=  obj.nom + ' ' + obj.prenom;
                str += '</div>';
                if (user === "Eleves"){
                    let sousgroupe = [];
                    if (obj.sousgroupe){
                        sousgroupe = obj.sousgroupe.split(',');
                    }
                    str += '<div class = "sousgroupe">';
                    str += '<ul>';
                    sousgroupe.forEach(sg => str += '<li>'+sg+'</li>');
                    str += '</ul>';
                    str += '</div>';
                    str += '<div class = "classe">';
                    str += obj.classe;
                    str += '</div>';
                } else if (user === "Professeurs"){
                    let classe = obj.classe.split(',');
                    let matiere = obj.matiere.split(',');
                    str += '<div class = "classe">';
                    str += '<ul>';
                    classe.forEach(cla => str += '<li>'+cla+'</li>');
                    str += '</ul>';
                    str += '</div>';
                    str += '<div class = "matiÃ¨re">';
                    str += '<ul>';
                    matiere.forEach(mat => str += '<li>'+mat+'</li>');
                    str += '</ul>';
                    str += '</div>';
                }
                str += '</li>';
            })
            str += '</ul>';
            div.html(str);
        }
        $(select).change(function () {
            AJAX();
        })

        function AJAX() {
            let user = select.children('option:selected').val();

            $.ajax({
                url: "{{ path('utilisateurs.choice') }}",
                method: "GET",
                data: {user: user, limit: 15, offset: offset}
            }).done(function (msg) {
                console.log(msg);
                refreshDiv(msg);
            })
        }
        AJAX();

    </script>
{% endblock %}